var heldDown1,heldDown2,charSelectHitboxes,selectableChars,p1Model,p2Model,lockInMessage,gravity=2,timee=0,timeeP=0;function cleanUpDivs(){var e=document.getElementById("lockInReady");null!=e&&e.parentNode.removeChild(e),null!=(e=document.getElementById("characterSelectBanner"))&&e.parentNode.removeChild(e),null!=(e=document.getElementById("pSelectContainer"))&&e.parentNode.removeChild(e)}function characterSelectLoop(){if(timee+=1,updatePositions(),updateGrabbedPlayers(),controllersConnected&&(updateP1Controller(),updateP2Controller()),p1InPosition&&p2InPosition&&!lockInMessage&&null==p1Model&&null==p2Model){var e=document.getElementById("container"),t=document.createElement("div");t.id="lockInReady",controllersConnected?t.innerHTML="Ready to Rumble! Press B To Begin!":t.innerHTML="Ready to Rumble! Press Space To Begin!",e.appendChild(t),lockInMessage=!0}else if((!p1InPosition||!p1InPosition)&&lockInMessage){var o=document.getElementById("lockInReady");null!=o&&o.parentNode.removeChild(o),lockInMessage=!1}charactersSelected?(inCharSelect=!1,p1InPosition=!1,p2InPosition=!1,charactersSelected=!1,lockInMessage=!1,cleanUpDivs(),buildStageSelect()):requestAnimationFrame(characterSelectLoop),renderer.render(characterSelectScene,characterSelectCamera)}function buildCharacterSelect(){inCharSelect=!0;var e=[[raider,raider1],[pingu,pingu1],[anh,anh1]];heldDown1={left:!1,right:!1,up:!1,down:!1},heldDown2={left:!1,right:!1,up:!1,down:!1},selectedPlayer1=void 0,selectedPlayer2=void 0,p1SelectorMesh=void 0,p2SelectorMesh=void 0,charSelectHitboxes=void 0,charSelectHitboxes=[],selectableChars=[],lockInMessage=!1,characterSelectScene=new THREE.Scene,characterSelectCamera.position.set(0,55,250),characterSelectCamera.lookAt(0,0,0),noonLights(characterSelectScene);var t=document.getElementById("container"),o=document.createElement("div");o.id="pSelectContainer",t.appendChild(o);var l=document.createElement("div");l.id="characterSelectBanner",l.innerHTML="Choose a Character!",t.appendChild(l);for(var a=0;a<e.length;a++){var n=createBasicBoxMesh(1+3*Math.random());characterSelectScene.add(n),n.position.x=30*a-90,n.position.y=28;var r=e[a][0].model.clone();characterSelectScene.add(r),selectableChars.push(r),r.position.x=30*a-90,r.position.y=38.5;var i=new THREE.BoxGeometry(10,15,10,1,1,1),d=new THREE.MeshPhongMaterial({color:16711680,transparent:!0,opacity:0}),s=new THREE.Mesh(i,d);s.userData={character:e[a]},characterSelectScene.add(s),charSelectHitboxes.push(s),s.position.x=30*a-90,s.position.y=44,s.position.z=10}for(a=0;a<numPlayers;a++){var c=document.createElement("div");c.id="p"+(a+1)+"Select",c.innerHTML="<div id = 'p1SelectBox'>Player "+(a+1)+": ?</div>",o.appendChild(c);var p=document.createElement("img");p.id="player"+(a+1)+"Img",p.src="./images/characters/unselected.png",p.style.height="90%",c.appendChild(p)}buildSelectors(),buildCapture(),characterSelectLoop()}function buildSelectors(){var e=new THREE.CylinderGeometry(3,3,1,19),t=new THREE.MeshPhongMaterial({map:(new THREE.TextureLoader).load("images/menu/player1Selector.jpg")});p1SelectorMesh=new THREE.Mesh(e,t),p1SelectorMesh.userData={name:"player1",grabbing:!1},characterSelectScene.add(p1SelectorMesh),p1SelectorMesh.position.set(-93,40,7),p1SelectorMesh.rotation.set(radians(90),radians(90),0);var o=new THREE.CylinderGeometry(3,3,1,19),l=new THREE.MeshPhongMaterial({map:(new THREE.TextureLoader).load("images/menu/player2Selector.jpg")});p2SelectorMesh=new THREE.Mesh(o,l),p2SelectorMesh.userData={name:"player2",grabbing:!1},characterSelectScene.add(p2SelectorMesh),p2SelectorMesh.position.set(-63,40,6),p2SelectorMesh.rotation.set(radians(90),radians(90),0)}function buildCapture(){var e=new THREE.BoxGeometry(300,5,10),t=new THREE.MeshPhongMaterial({color:2567826}),o=new THREE.Mesh(e,t);characterSelectScene.add(o),o.position.set(150,-20,10);var l=new THREE.BoxGeometry(300,5,10),a=new THREE.MeshPhongMaterial({color:11931158}),n=new THREE.Mesh(l,a);characterSelectScene.add(n),n.position.set(-150,-20,10)}function checkCollision(e,t){for(var o=new THREE.BoxHelper(e,16711680),l=(new THREE.Box3).setFromObject(o),a=0;a<t.length;a++){var n=new THREE.BoxHelper(t[a],16711680),r=(new THREE.Box3).setFromObject(n);if(l.intersectsBox(r)){if("player1"==e.userData.name){selectedPlayer1=void 0,p1InPosition=!1;var i=document.getElementById("p1Select");i.innerHTML="<div id = 'p1SelectName'>Player 1: ?</div>";var d=document.createElement("img");d.id="player1Img",d.src="./images/characters/unselected.png",d.style.height="90%",i.appendChild(d),grabbedPlayer1=t[a].userData.character[0],p1Model=grabbedPlayer1.model.clone(),e.position.z=19,characterSelectScene.add(p1Model),p1Model.position.set(e.position.x,e.position.y,e.position.z-4),p1Model.userData={heldBy:"player1",selected:!0,velocity:0,name:grabbedPlayer1.name},e.userData.grabbing=!0}if("player2"==e.userData.name){selectedPlayer2=void 0,p2InPosition=!1;var s=document.getElementById("p2Select");s.innerHTML="<div id = 'p2SelectName'>Player 2: ?</div>";var c=document.createElement("img");c.id="player2Img",c.src="./images/characters/unselected.png",c.style.height="90%",s.appendChild(c),grabbedPlayer2=t[a].userData.character[1],console.log(t[a]),p2Model=grabbedPlayer2.model.clone(),e.position.z=17,characterSelectScene.add(p2Model),p2Model.position.set(e.position.x,e.position.y,e.position.z-4),p2Model.userData={heldBy:"player2",selected:!0,velocity:0,name:grabbedPlayer2.name},e.userData.grabbing=!0}}}}function dropPlayer(e,t){e.userData.grabbing=!1,t.userData.heldBy="",t.userData.selected=!1,"player1"==e.userData.name?t.position.x<0&&(p1InPosition=!0):t.position.x>0&&(p2InPosition=!0),"player1"==e.userData.name?e.position.z=7:e.position.z=6}function updatePositions(){heldDown1.left&&p1SelectorMesh.position.x-1>-112&&(p1SelectorMesh.position.x-=1,null!=p1Model&&""!=p1Model.userData.heldBy&&(p1Model.position.x-=1)),heldDown1.right&&p1SelectorMesh.position.x+1<112&&(p1SelectorMesh.position.x+=1,null!=p1Model&&""!=p1Model.userData.heldBy&&(p1Model.position.x+=1)),heldDown1.up&&p1SelectorMesh.position.y+1<55&&(p1SelectorMesh.position.y+=1,null!=p1Model&&""!=p1Model.userData.heldBy&&(p1Model.position.y+=1)),heldDown1.down&&p1SelectorMesh.position.y-1>-21&&(p1SelectorMesh.position.y-=1,null!=p1Model&&""!=p1Model.userData.heldBy&&(p1Model.position.y-=1)),heldDown2.left&&p2SelectorMesh.position.x-1>-112&&(p2SelectorMesh.position.x-=1,null!=p2Model&&""!=p2Model.userData.heldBy&&(p2Model.position.x-=1)),heldDown2.right&&p2SelectorMesh.position.x+1<112&&(p2SelectorMesh.position.x+=1,null!=p2Model&&""!=p2Model.userData.heldBy&&(p2Model.position.x+=1)),heldDown2.up&&p2SelectorMesh.position.y+1<55&&(p2SelectorMesh.position.y+=1,null!=p2Model&&""!=p2Model.userData.heldBy&&(p2Model.position.y+=1)),heldDown2.down&&p2SelectorMesh.position.y-1>-21&&(p2SelectorMesh.position.y-=1,null!=p2Model&&""!=p2Model.userData.heldBy&&(p2Model.position.y-=1))}function updateGrabbedPlayers(){if(null!=p1Model&&0==p1Model.userData.selected)if(p1Model.position.y<-25&&p1Model.position.x<0){var e=document.getElementById("p1Select");e.innerHTML="<div id = 'p1SelectName'>Player 1: "+p1Model.userData.name+"</div>";var t=document.createElement("img");t.id="player1Img",t.src="./images/characters/"+p1Model.userData.name+"Small.png",t.style.height="90%",selectedPlayer1=grabbedPlayer1,e.appendChild(t),characterSelectScene.remove(p1Model),p1Model=void 0}else p1Model.position.y-=p1Model.userData.velocity,p1Model.userData.velocity<gravity&&(p1Model.userData.velocity+=.1);if(null!=p2Model&&0==p2Model.userData.selected)if(p2Model.position.y<-25&&p2Model.position.x>0){var o=document.getElementById("p2Select");o.innerHTML="<div id = 'p2SelectName'>Player 2: "+p2Model.userData.name+"</div>";var l=document.createElement("img");l.id="player2Img",l.src="./images/characters/"+p2Model.userData.name+"Small.png",l.style.height="90%",selectedPlayer2=grabbedPlayer2,o.appendChild(l),characterSelectScene.remove(p2Model),p2Model=void 0}else p2Model.position.y-=p2Model.userData.velocity,p2Model.userData.velocity<gravity&&(p2Model.userData.velocity+=.1)}function updateP2Controller(){inCharSelect&&(2==axis2.length?(axis2[0]<-.5?(heldDown2.left=!0,heldDown2.right=!1):axis2[0]>.5&&(heldDown2.right=!0,heldDown2.left=!1),axis2[1]<-.8?(heldDown2.up=!0,heldDown2.down=!1):axis2[1]>.8&&(heldDown2.down=!0,heldDown2.up=!1)):(heldDown2.left=!1,heldDown2.right=!1,heldDown2.up=!1,heldDown2.down=!1),pressedButtons2[1]&&timee-timeeP>30&&(timeeP=timee,p2SelectorMesh.userData.grabbing?dropPlayer(p2SelectorMesh,p2Model):checkCollision(p2SelectorMesh,charSelectHitboxes)),pressedButtons2[0]&&null!=selectedPlayer1&&null!=selectedPlayer2&&p1InPosition&&p2InPosition&&(charactersSelected=!0))}function updateP1Controller(){inCharSelect&&(2==axis1.length?(axis1[0]<-.5?(heldDown1.left=!0,heldDown1.right=!1):axis1[0]>.5&&(heldDown1.right=!0,heldDown1.left=!1),axis1[1]<-.5?(heldDown1.up=!0,heldDown1.down=!1):axis1[1]>.5&&(heldDown1.down=!0,heldDown1.up=!1)):(heldDown1.left=!1,heldDown1.right=!1,heldDown1.up=!1,heldDown1.down=!1),pressedButtons1[1]&&timee-timeeP>30&&(timeeP=timee,p1SelectorMesh.userData.grabbing?dropPlayer(p1SelectorMesh,p1Model):checkCollision(p1SelectorMesh,charSelectHitboxes)),pressedButtons1[0]&&null!=selectedPlayer1&&null!=selectedPlayer2&&p1InPosition&&p2InPosition&&(charactersSelected=!0))}
