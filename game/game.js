var camera,fieldOfView,aspectRatio,nearPlane,farPlane,renderer,container,characterSelectCamera,mediaElement,statsOn,stats,controls,SELECTEDMODE,selectedPlayer1,selectedPlayer2,p1SelectorMesh,p2SelectorMesh,characterSelectScene,HIGHLITED,selectedStage,stage,mapScene,HEIGHT,WIDTH,Colors={skyBlue:8842188,ground:3352073,golden:15445802,white:16777215,grey:13093320},numPlayers=2,omegaOn=!1,isDay=!0,playingM=!1,hitBoxesOn=!1,trackPlayer=!1,mobileMode=!1,drawRays=!1,devMode=!1,raycaster=new THREE.Raycaster,mouse=new THREE.Vector2,modes=["normal","options"],modeBlocks=[],inMainMenu=!1,titleClicked=!1,selectingTitle=!0,inModeSelect=!1,modeSelected=!1,inCharSelect=!1,p1InPosition=!1,p2InPosition=!1,charactersSelected=!1,inStageSelect=!1,stageSelected=!1,selectableStages=[],currentLights=[],currentSpotLight=void 0,inGame=!1,countDown=!1,winner=-1,gameStarted=!1,inPostGame=!1,gameOver=!1,roundOver=!1,player1Info={damageDealt:0,damageReceived:0,inAirDuration:0,totalAttacksCast:0,totalAttacksHit:0},player2Info={damageDealt:0,damageReceived:0,inAirDuration:0,totalAttacksCast:0,totalAttacksHit:0};function createCameraRender(){HEIGHT=window.innerHeight,WIDTH=window.innerWidth,aspectRatio=WIDTH/HEIGHT,fieldOfView=60,nearPlane=1,farPlane=1e4,(camera=new THREE.PerspectiveCamera(fieldOfView,aspectRatio,nearPlane,farPlane)).position.x=0,camera.position.z=120,camera.position.y=40,stageSelectCamera=new THREE.PerspectiveCamera(30,aspectRatio,nearPlane,farPlane),stageSelectCamera.position.x=0,stageSelectCamera.position.z=120,stageSelectCamera.position.y=40,modeSelectCamera=new THREE.PerspectiveCamera(fieldOfView,aspectRatio,nearPlane,farPlane),characterSelectCamera=new THREE.PerspectiveCamera(25,aspectRatio,nearPlane,farPlane),postGameCamera=new THREE.PerspectiveCamera(fieldOfView,aspectRatio,nearPlane,farPlane),(renderer=new THREE.WebGLRenderer({alpha:!0,antialias:!0})).setSize(WIDTH,HEIGHT),renderer.shadowMap.enabled=!0,renderer.shadowMap.type=THREE.PCFSoftShadowMap,(container=document.getElementById("glcanvas")).appendChild(renderer.domElement),window.addEventListener("resize",handleWindowResize,!1),window.addEventListener("mousemove",onMouseMove,!1),window.addEventListener("mousedown",onMouseDown,!1)}function handleWindowResize(){HEIGHT=window.innerHeight,WIDTH=window.innerWidth,renderer.setSize(WIDTH,HEIGHT),camera.aspect=WIDTH/HEIGHT,camera.updateProjectionMatrix(),stageSelectCamera.aspect=WIDTH/HEIGHT,stageSelectCamera.updateProjectionMatrix(),characterSelectCamera.aspect=WIDTH/HEIGHT,characterSelectCamera.updateProjectionMatrix(),postGameCamera.aspect=WIDTH/HEIGHT,postGameCamera.updateProjectionMatrix()}function loop(){if(doUpdates(),renderer.render(stage.scene,camera),statsOn&&stats.update(),roundOver){var e=document.getElementById("timerBox");e.parentNode.removeChild(e),(e=document.getElementById("player1Box")).parentNode.removeChild(e),(e=document.getElementById("player2Box")).parentNode.removeChild(e),roundOver=!1,gameOver=!1,inGame=!1,buildPostGame()}else requestAnimationFrame(loop),stage.snowing&&rotateSnow(),trackPlayer?(camera.position.set(stage.player1.model.position.x,stage.player1.model.position.y+50,stage.player1.model.position.z+120),stage.player1.model.position.x<0?camera.lookAt(stage.player1.model.position.x*+stage.player1.model.position.x*-.005,stage.player1.model.position.y,stage.player1.model.position.z):camera.lookAt(stage.player1.model.position.x*+stage.player1.model.position.x*.005,stage.player1.model.position.y,stage.player1.model.position.z)):(camera.position.set((stage.player1.model.position.x+stage.player2.model.position.x)/2,(stage.player1.model.position.y+stage.player2.model.position.y)/2+50,stage.player1.model.position.z+120+.1*Math.abs(stage.player1.model.position.x-stage.player2.model.position.x)),camera.lookAt((stage.player1.model.position.x+stage.player2.model.position.x)/2,(stage.player1.model.position.y+stage.player2.model.position.y)/2,stage.stageBlocks[0].model.position.z),camera.position.x<-90&&(camera.position.x=-90),camera.position.x>90&&(camera.position.x=90),camera.position.y<-40&&(camera.position.y=-40),camera.position.y>100&&(camera.position.y=100)),lookDirection([1,0,0]),lookDirection([-1,0,0]),lookDirection([0,1,0]),lookDirection([0,-1,0])}var controllersConnected=!1;function doUpdates(){controllersConnected&&(updateInputsPlayer1(),updateInputsPlayer2()),stage.player1.update(),stage.player1.animate(),stage.player2.update(),stage.player2.animate(),stage.update()}let interval;function initGame(){THREEx.FullScreen.bindKey({charCode:"l".charCodeAt(0)}),document.onkeydown=handleKeyDown,document.onkeyup=handleKeyUp,setUpGamePads(),buildTitleScreen()}var p1GamePadR=[!1,!1,!1,!1],p1GamePadL=[!1,!1,!1,!1],p1Control=[0,0,0,0],p2GamePadR=[!1,!1,!1,!1],p2GamePadL=[!1,!1,!1,!1],p2Control=[0,0,0,0];function initializeWorld(){inGame=!0,contols=void 0,player1Info={damageDealt:0,damageReceived:0,inAirDuration:0,totalAttacksCast:0,totalAttacksHit:0},player2Info={damageDealt:0,damageReceived:0,inAirDuration:0,totalAttacksCast:0,totalAttacksHit:0},devMode||(stage=selectedStage.stageData),stage.init(),console.log(stage),camera.lookAt(stage.stageBlocks[0].model.position.x,stage.stageBlocks[0].model.position.y+10,stage.stageBlocks[0].model.position.z);var e=new THREE.AudioListener;new THREE.Audio(e);console.log(stage.bgm),(mediaElement=new Audio(stage.bgm)).loop=!0,loop()}function setUpGamePads(){window.addEventListener("gamepadconnected",function(e){controllersConnected=!0;const a=e.gamepad;console.log(`Gamepad connected at index ${a.index}: ${a.id}.\n                  ${a.buttons.length} buttons, ${a.axes.length} axes.`)}),"ongamepadconnected"in window||(interval=setInterval(pollGamepads,10))}var pressedButtons1=[],axis1=[],pressedButtons2=[],axis2=[],allAxis=[];function pollGamepads(){const e=navigator.getGamepads?navigator.getGamepads():[];pressedButtons=[];for(let a=0;a<e.length;a++){0==a&&(pressedButtons1=[],axis1=[]),1==a&&(pressedButtons2=[],axis2=[]);const t=e[a];if(t){for(let e=0;e<t.buttons.length;e++)t.buttons[e].pressed?(0==a&&(pressedButtons1[e]=!0),1==a&&(pressedButtons2[e]=!0)):(0==a&&(pressedButtons1[e]=!1),1==a&&(pressedButtons2[e]=!1));for(let e=0;e<t.axes.length;e++)t.axes[e]&&(0==a&&(axis1[e]=t.axes[e]),1==a&&(axis2[e]=t.axes[e]))}}}function updateInputsPlayer1(){stage.player1.canMove&&(pressedButtons1[0]&&(stage.player1.heldKeys.attack2=!0,stage.player1.doAnyAttack()),pressedButtons1[0]||(stage.player1.heldKeys.attack2=!1),pressedButtons1[1]&&(stage.player1.heldKeys.attack1=!0,stage.player1.doAnyAttack()),pressedButtons1[1]||(stage.player1.heldKeys.attack1=!1),(pressedButtons1[2]||pressedButtons1[3])&&(stage.player1.heldKeys.up=!0,stage.player1.jump()),pressedButtons1[2]||(stage.player1.heldKeys.up=!1),pressedButtons1[3]||(stage.player1.heldKeys.up=!1),2==axis1.length?(axis1[0]<-.5?(stage.player1.heldKeys.left=!0,stage.player1.heldKeys.right=!1,stage.player1.movingR=!1):axis1[0]>.5&&(stage.player1.heldKeys.right=!0,stage.player1.heldKeys.left=!1,stage.player1.movingL=!1),axis1[1]>-.8?(stage.player1.heldKeys.down=!0,stage.player1.heldKeys.up=!1,stage.player1.jumping=!1):axis1[1]<.8&&(stage.player1.heldKeys.up=!0,stage.player1.heldKeys.down=!1,stage.player1.heldKeys.up&&stage.player1.heldKeys.attack2&&stage.player1.canRecover&&!stage.player1.isRecover&&(stage.player1.sleeping||(stage.player1.recover(),stage.player1.canJump=!1)),stage.player1.jump())):(stage.player1.heldKeys.left=!1,stage.player1.heldKeys.down=!1,stage.player1.heldKeys.right=!1,stage.player1.heldKeys.up=!1,stage.player1.movingL=!1,stage.player1.movingR=!1),pressedButtons1[13]&&(stage.player1.heldKeys.down=!0),pressedButtons1[13]||(stage.player1.heldKeys.down=!1),pressedButtons1[12]&&(stage.player1.heldKeys.up=!0,stage.player1.jump()),pressedButtons1[12]||(stage.player1.heldKeys.up=!1))}function updateInputsPlayer2(){stage.player2.canMove&&(pressedButtons2[0]&&(stage.player2.heldKeys.attack2=!0,stage.player2.doAnyAttack()),pressedButtons2[0]||(stage.player2.heldKeys.attack2=!1),pressedButtons2[1]&&(stage.player2.heldKeys.attack1=!0,stage.player2.doAnyAttack()),pressedButtons2[1]||(stage.player2.heldKeys.attack1=!1),(pressedButtons2[2]||pressedButtons2[3])&&(stage.player2.heldKeys.up=!0,stage.player2.jump()),pressedButtons2[2]||(stage.player2.heldKeys.up=!1),pressedButtons2[3]||(stage.player2.heldKeys.up=!1),2==axis2.length?(axis2[0]<-.5?(stage.player2.heldKeys.left=!0,stage.player2.heldKeys.right=!1,stage.player2.movingR=!1):axis2[0]>.5&&(stage.player2.heldKeys.right=!0,stage.player2.heldKeys.left=!1,stage.player2.movingL=!1),axis2[1]>-.8?(stage.player2.heldKeys.down=!0,stage.player2.heldKeys.up=!1,stage.player2.jumping=!1):axis2[1]<.8&&(stage.player2.heldKeys.up=!0,stage.player2.heldKeys.down=!1,stage.player2.heldKeys.up&&stage.player2.heldKeys.attack2&&stage.player2.canRecover&&!stage.player2.isRecover&&(stage.player2.sleeping||(stage.player2.recover(),stage.player2.canJump=!1)),stage.player2.jump())):(stage.player2.heldKeys.left=!1,stage.player2.heldKeys.down=!1,stage.player2.heldKeys.right=!1,stage.player2.heldKeys.up=!1,stage.player2.movingL=!1,stage.player2.movingR=!1),pressedButtons2[13]&&(stage.player2.heldKeys.down=!0),pressedButtons2[13]||(stage.player2.heldKeys.down=!1),pressedButtons2[12]&&(stage.player2.heldKeys.up=!0,stage.player2.jump()),pressedButtons2[12]||(stage.player2.heldKeys.up=!1))}
