var RESET=!1,ATTACK=!0,pingu={name:"Pingu",model:createPinguMesh(0,0,0),secondary:createPinguMesh(0,0,0),hitBox:createPinguBounding(0,0,0),canAAttack:[!0,!0,!0,!0,!0,!0],canBAttack:[!0,!0,!0,!0],hitByA:[!1,!1,!1,!1,!1],hitByB:[!1,!1,!1,!1],init:function(){for(var t=Object.keys(charProto),s=0;s<t.length;s++)this[t[s]]=charProto[t[s]];this.name="Pingu",stage.scene.add(this.secondary),this.hearts=createHearts(stage,stage.maximumX+300,stage.maximumY+300,0),this.secondary.position.set(stage.maximumX+300,stage.maximumY+300,0),this.recoverVel=3.5,this.jumpSpeed=2,this.heldKeys={up:!1,down:!1,left:!1,right:!1,attack1:!1,attack2:!1},this.basicAttackObj=pinguBasic,this.specialAttackObj=pinguSpecial},setSpawn:function(){this.isPlayer1?(this.x=stage.player1SpawnX,this.y=stage.player1SpawnY,this.z=stage.player1SpawnZ):(this.x=stage.player2SpawnX,this.y=stage.player2SpawnY,this.z=stage.player2SpawnZ)},update:function(){if(this.onGround||(this.isPlayer1?player1Info.inAirDuration+=1/60:player2Info.inAirDuration+=1/60),this.hitbbox=(new THREE.Box3).setFromObject(this.hitBox),isDay||(this.isPlayer1?(stage.player1SpotTarget.position.set(this.x,this.y+10,-10),stage.player1Spot.target=stage.player1SpotTarget):(stage.player2SpotTarget.position.set(this.x,this.y+10,-10),stage.player2Spot.target=stage.player2SpotTarget)),null!=this.boxBelow?this.minDown=this.boxBelow.position.y+this.boxBelow.userData.height/2+this.height/2:this.minDown=-1e3,null!=this.boxLeft?this.minLeft=this.boxLeft.position.x+this.boxLeft.userData.width/2+this.width/2:this.minLeft=-1e3,null!=this.boxRight?this.minRight=this.boxRight.position.x-this.boxRight.userData.width/2-this.width/2:this.minRight=1e3,null!=this.boxAbove?this.minUp=this.boxAbove.position.y-this.boxAbove.userData.height/2-this.height/2:this.minUp=1e5,this.isHit&&(this.hitFrames-=1,this.sleeping=!1),this.hitFrames<0&&(this.isHit=!1),this.yVel-.075<-1.6&&(this.yVel=-1.6),this.yVel-=.075,this.x+=this.xVel,this.y+=this.yVel,this.xVel>8||this.yVel>8){var t=this.model.clone();stage.scene.add(t),setTimeout(function(){stage.scene.remove(t)},50)}this.heldKeys.up&&this.heldKeys.attack2&&this.canRecover&&!this.isRecover&&(this.sleeping||(this.recover(),this.canJump=!1)),!this.heldKeys.right||this.heldKeys.left||this.isHit||this.walkRight(),!this.heldKeys.left||this.heldKeys.right||this.isHit||this.walkLeft(),this.movingR||this.movingL||!this.onGround||this.isHit||(this.xVel=.7*this.xVel),this.movingR||this.movingL||this.onGround||this.isHit||(this.xVel=.98*this.xVel),Math.abs(this.xVel)<5e-4&&(this.xVel=0),this.y<this.minDown&&(this.y=this.minDown,this.canJump=!0,this.jumpCt=0,this.onGround=!0,this.canRecover=!0,this.isRecover=!1),this.y>this.minUp&&(this.y=this.minUp,this.yVel=0),this.x<this.minLeft&&(this.x=this.minLeft),this.x>this.minRight&&(this.x=this.minRight),0==this.stock?(this.model.position.set(1e3,1e3,0),this.hitBox.position.set(1e3,1e3,0)):(this.model.position.set(this.x,this.y,this.z),this.hitBox.position.set(this.x,this.y+2,this.z)),this.y>this.minDown&&(this.onGround=!1)},animate:function(){if(this.isRecoiling&&(this.recoilFrames-=1,this.recoilFrames<=0&&(this.recoilFrames=this.recoilFrameDefault,this.isRecoiling=!1)),this.facingR&&this.canBAttack[US]&&(this.model.rotation.y=.5),this.facingL&&this.canBAttack[US]&&(this.model.rotation.y=-.5),!this.movingR&&!this.movingL||0==this.xVel||this.isHit?(this.model.torso.rightLeg.position.y=-3,this.model.torso.leftLeg.position.y=-3,this.model.torso.rightLeg.rotation.x=0,this.model.torso.leftLeg.rotation.x=0,this.model.torso.rightArm.rotation.x=0,this.model.torso.leftArm.rotation.x=-0,this.canBasicAttack&&!this.isHit&&(this.model.rotation.z=0)):(this.walkStyle1&&(this.model.torso.rightLeg.rotation.x=.4*Math.sin(.7*stage.timer),this.model.torso.leftLeg.rotation.x=-.4*Math.sin(.7*stage.timer)),this.model.torso.rightArm.rotation.x=.3*Math.sin(.5*stage.timer),this.model.torso.leftArm.rotation.x=-.3*Math.sin(.5*stage.timer),this.canBasicAttack&&(this.model.rotation.z=0)),stage.timer%500==0?(this.model.head.rightEye.scale.set(1,.2,1),this.model.head.leftEye.scale.set(1,.2,1)):(this.model.head.rightEye.scale.set(1,1,1),this.model.head.leftEye.scale.set(1,1,1)),!this.canAAttack[A]){var t=1-(this.recoilFrameDefault-this.recoilFrames)/this.recoilFrameDefault,s=(this.basicAttackObj.attackFrames[A]-this.basicAttackFrames)/this.basicAttackObj.attackFrames[A];if(this.isRecoiling?this.facingL?(this.model.torso.rightArm.scale.set(1+s*t*.6,1+s*t*.6,1+s*t*.6),this.model.torso.rightArm.rightHand.sword.scale.set(1,1+s*t*1,1),this.model.torso.rightArm.rotation.z=t*this.model.torso.rightArm.rotation.z):(this.model.torso.leftArm.scale.set(1+s*t*.6,1+s*t*.6,1+s*t*.6),this.model.torso.leftArm.rotation.z=t*this.model.torso.leftArm.rotation.z):(this.basicAttackFrames-=1,this.facingL?(s<.25&&(this.model.torso.rightArm.scale.set(1+.6*s*4,1+.6*s*4,1+.6*s*4),this.model.torso.rightArm.rightHand.sword.scale.set(1,1+1*s*4,1)),this.model.torso.rightArm.rotation.z+=.1):s<.25?this.model.torso.leftArm.scale.set(1.6,2,1.6):this.model.torso.leftArm.rotation.z=s*radians(180)),this.facingL){var i=new THREE.BoxHelper(this.model.torso.rightArm.rightHand.sword,16711680);this.attackbbox=(new THREE.Box3).setFromObject(i),this.attackbbox.intersectsBox(this.otherPlayer.hitbbox)&&this.checkHit(A,"A"),hitBoxesOn&&(stage.scene.add(i),setTimeout(function(){i.geometry.dispose()},50),setTimeout(function(){stage.scene.remove(i)},50))}else{i=new THREE.BoxHelper(this.model.torso.leftArm,16711680);this.attackbbox=(new THREE.Box3).setFromObject(i),this.attackbbox.intersectsBox(this.otherPlayer.hitbbox)&&this.checkHit(A,"A"),hitBoxesOn&&(stage.scene.add(i),setTimeout(function(){i.geometry.dispose()},50),setTimeout(function(){stage.scene.remove(i)},50))}this.basicAttackFrames<=0&&(this.model.torso.rightArm.scale.set(1,1,1),this.model.torso.leftArm.scale.set(1,1,1),this.model.torso.rightArm.rightHand.sword.scale.set(1,1,1),this.model.torso.rightArm.rotation.z=0,this.model.torso.leftArm.rotation.z=0,this.basicAttackFrames=25,this.canAAttack[A]=!0,this.canBasicAttack=!0,this.otherPlayer.hitByA[A]=!1)}if(!this.canAAttack[FA]){this.basicAttackFrames-=1;s=(this.basicAttackObj.attackFrames[FA]-this.basicAttackFrames)/this.basicAttackObj.attackFrames[FA];this.facingL?(s<.25?(this.model.rotation.z=4*s*1.57,this.model.torso.rightArm.scale.set(1.6,1.6,1.6),this.model.torso.rightArm.rightHand.sword.scale.set(1,2.2,1),this.model.torso.rightArm.rotation.z-=.1):this.model.rotation.x=3*s*3.14,this.x-1.8>=this.minLeft&&(this.x-=1.8)):(s<.25?(this.model.rotation.z=-4*s*1.57,this.model.torso.rightArm.scale.set(1.6,1.6,1.6),this.model.torso.rightArm.rightHand.sword.scale.set(1,2.2,1),this.model.torso.rightArm.rotation.z-=.1):this.model.rotation.x=3*s*3.14,this.x+1.8<=this.minRight&&(this.x+=1.8));i=new THREE.BoxHelper(this.model.torso.rightArm.rightHand.sword,16711680);this.attackbbox=(new THREE.Box3).setFromObject(i),this.attackbbox.intersectsBox(this.otherPlayer.hitbbox)&&this.checkHit(FA,"A"),hitBoxesOn&&(stage.scene.add(i),setTimeout(function(){i.geometry.dispose()},50),setTimeout(function(){stage.scene.remove(i)},50)),this.basicAttackFrames<=0&&(this.model.rotation.z=0,this.model.rotation.x=0,this.model.torso.rightArm.rotation.z=0,this.model.torso.rightArm.scale.set(1,1,1),this.model.torso.leftArm.scale.set(1,1,1),this.model.torso.rightArm.rightHand.sword.scale.set(1,1,1),this.basicAttackFrames=25,this.canAAttack[FA]=!0,this.canBasicAttack=!0,this.otherPlayer.hitByA[FA]=!1)}if(!this.canAAttack[BA]){t=1-(this.recoilFrameDefault-this.recoilFrames)/this.recoilFrameDefault,s=(this.basicAttackObj.attackFrames[BA]-this.basicAttackFrames)/this.basicAttackObj.attackFrames[BA];if(this.basicAttackFrames-=1,this.facingL?(s<.25&&(this.model.torso.rightArm.scale.set(1+.6*s*4,1+.6*s*4,1+.6*s*4),this.model.torso.rightArm.rightHand.sword.scale.set(1,1+1*s*4,1)),this.model.torso.rightArm.rotation.z+=.1):s<.25?this.model.torso.leftArm.scale.set(1.6,2,1.6):this.model.torso.leftArm.rotation.z=s*radians(180),this.facingL){i=new THREE.BoxHelper(this.model.torso.rightArm.rightHand.sword,16711680);this.attackbbox=(new THREE.Box3).setFromObject(i),this.attackbbox.intersectsBox(this.otherPlayer.hitbbox)&&this.checkHit(BA,"A"),hitBoxesOn&&(stage.scene.add(i),setTimeout(function(){i.geometry.dispose()},50),setTimeout(function(){stage.scene.remove(i)},50))}else{i=new THREE.BoxHelper(this.model.torso.leftArm,16711680);this.attackbbox=(new THREE.Box3).setFromObject(i),this.attackbbox.intersectsBox(this.otherPlayer.hitbbox)&&this.checkHit(BA,"A"),hitBoxesOn&&(stage.scene.add(i),setTimeout(function(){i.geometry.dispose()},50),setTimeout(function(){stage.scene.remove(i)},50))}this.basicAttackFrames<=0&&(this.model.torso.rightArm.scale.set(1,1,1),this.model.torso.leftArm.scale.set(1,1,1),this.model.torso.rightArm.rightHand.sword.scale.set(1,1,1),this.model.torso.rightArm.rotation.z=0,this.model.torso.leftArm.rotation.z=0,this.basicAttackFrames=25,this.canAAttack[BA]=!0,this.canBasicAttack=!0,this.otherPlayer.hitByA[BA]=!1)}if(!this.canAAttack[DA]){this.basicAttackFrames-=1;s=(this.basicAttackObj.attackFrames[DA]-this.basicAttackFrames)/this.basicAttackObj.attackFrames[DA];this.model.torso.rightLeg.scale.set(1.1,1,3),this.model.torso.leftLeg.scale.set(1.1,1,3),this.model.torso.rightLeg.rotation.x=-s*Math.sin(.5*this.basicAttackFrames),this.model.torso.leftLeg.rotation.x=s*Math.sin(.5*this.basicAttackFrames);var e=new THREE.BoxHelper(this.model.torso.rightLeg,16711680);this.attackbbox=(new THREE.Box3).setFromObject(e),this.attackbbox.intersectsBox(this.otherPlayer.hitbbox)&&this.checkHit(DA,"A");var a=new THREE.BoxHelper(this.model.torso.leftLeg,16711680);this.attackbbox=(new THREE.Box3).setFromObject(a),this.attackbbox.intersectsBox(this.otherPlayer.hitbbox)&&this.checkHit(DA,"A"),hitBoxesOn&&(stage.scene.add(e),setTimeout(function(){e.geometry.dispose()},50),setTimeout(function(){stage.scene.remove(e)},50),stage.scene.add(a),setTimeout(function(){a.geometry.dispose()},50),setTimeout(function(){stage.scene.remove(a)},50)),this.basicAttackFrames<=0&&(this.model.torso.rightLeg.scale.set(1,1,1),this.model.torso.leftLeg.scale.set(1,1,1),this.basicAttackFrames=25,this.canAAttack[DA]=!0,this.canBasicAttack=!0,this.otherPlayer.hitByA[DA]=!1)}if(!this.canAAttack[UA]){this.basicAttackFrames-=1;s=(this.basicAttackObj.attackFrames[UA]-this.basicAttackFrames)/this.basicAttackObj.attackFrames[UA];this.model.torso.rightArm.scale.set(1+.6*s,1+.6*s,1+.6*s),this.model.torso.rightArm.rightHand.sword.scale.set(1,2,1),s<.25?(this.model.torso.rightArm.rotation.z=-8*s*1.57,this.model.torso.rightArm.rightHand.sword.rotation.z=7.8*s*1.57,this.model.torso.rightArm.rightHand.sword.position.x+=.01,this.model.torso.rightArm.rightHand.sword.position.y-=.05,this.model.torso.rightArm.rightHand.sword.position.z-=.2):this.model.rotation.y=s*radians(720);i=new THREE.BoxHelper(this.model.torso.rightArm.rightHand.sword,16711680);this.attackbbox=(new THREE.Box3).setFromObject(i),this.attackbbox.intersectsBox(this.otherPlayer.hitbbox)&&this.checkHit(UA,"A"),hitBoxesOn&&(stage.scene.add(i),setTimeout(function(){i.geometry.dispose()},50),setTimeout(function(){stage.scene.remove(i)},50)),this.basicAttackFrames<=0&&(this.model.torso.rightArm.scale.set(1,1,1),this.model.torso.leftArm.scale.set(1,1,1),this.model.torso.rightArm.rightHand.sword.scale.set(1,1,1),this.model.torso.rightArm.rightHand.sword.position.set(-.4,1,.7),this.model.torso.rightArm.rightHand.sword.rotation.set(0,0,.6),this.model.torso.rightArm.rotation.z=0,this.model.rotation.y=0,this.basicAttackFrames=25,this.canAAttack[UA]=!0,this.canBasicAttack=!0,this.otherPlayer.hitByA[UA]=!1)}if(!this.canAAttack[NA]){this.basicAttackFrames-=1;s=(this.basicAttackObj.attackFrames[NA]-this.basicAttackFrames)/this.basicAttackObj.attackFrames[NA];this.model.rotation.z=2*s*Math.PI,this.model.torso.rightArm.scale.set(1+.6*s,1+.6*s,1+.6*s),this.model.torso.rightArm.rightHand.sword.scale.set(1,2,1),this.model.torso.rightArm.rotation.z+=.1;i=new THREE.BoxHelper(this.model.torso.rightArm.rightHand.sword,16711680);this.attackbbox=(new THREE.Box3).setFromObject(i),this.attackbbox.intersectsBox(this.otherPlayer.hitbbox)&&this.checkHit(NA,"A"),hitBoxesOn&&(stage.scene.add(i),setTimeout(function(){i.geometry.dispose()},50),setTimeout(function(){stage.scene.remove(i)},50)),this.basicAttackFrames<=0&&(this.model.rotation.z=0,this.model.torso.rightArm.scale.set(1,1,1),this.model.torso.rightArm.rightHand.sword.scale.set(1,1,1),this.model.torso.rightArm.rotation.z=.1,this.basicAttackFrames=25,this.canAAttack[NA]=!0,this.canBasicAttack=!0,this.otherPlayer.hitByA[NA]=!1)}if(!this.canBAttack[S]){this.basicAttackFrames-=1.5,dabbing(ATTACK,this.model);i=new THREE.BoxHelper(this.model,16711680);this.attackbbox=(new THREE.Box3).setFromObject(i),this.attackbbox.intersectsBox(this.otherPlayer.hitbbox)&&this.checkHit(S,"B"),hitBoxesOn&&(stage.scene.add(i),setTimeout(function(){i.geometry.dispose()},50),setTimeout(function(){stage.scene.remove(i)},50)),this.basicAttackFrames<=0&&(dabbing(RESET,this.model),this.basicAttackFrames=25,this.canBAttack[S]=!0,this.canBasicAttack=!0,this.otherPlayer.hitByB[S]=!1)}if(!this.canBAttack[SS]){this.basicAttackFrames-=1,dabbing(ATTACK,this.model),this.basicAttackFrames!=this.specialAttackObj.attackFrames[SS]-1||this.isRecover?(this.specialAttackObj.castedRight||(this.secondary.position.x-=2.5),this.specialAttackObj.castedRight&&(this.secondary.position.x+=2.5)):(this.facingL&&(this.specialAttackObj.castedRight=!1,this.secondary.position.set(this.x,this.y,this.z)),this.facingR&&(this.specialAttackObj.castedRight=!0,this.secondary.position.set(this.x,this.y,this.z))),dabbing(ATTACK,this.secondary);i=new THREE.BoxHelper(this.secondary,16711680);this.attackbbox=(new THREE.Box3).setFromObject(i),this.attackbbox.intersectsBox(this.otherPlayer.hitbbox)&&this.checkHit(SS,"B"),hitBoxesOn&&(stage.scene.add(i),setTimeout(function(){i.geometry.dispose()},50),setTimeout(function(){stage.scene.remove(i)},50)),this.basicAttackFrames<=0&&(dabbing(RESET,this.model),dabbing(RESET,this.secondary),this.basicAttackFrames=25,this.canBAttack[SS]=!0,this.canBasicAttack=!0,this.otherPlayer.hitByB[SS]=!1,this.secondary.position.set(stage.maximumX+300,stage.maximumY+300,0))}if(!this.canBAttack[US]){this.basicAttackFrames-=2.5,this.model.rotation.y+=.78;var o=new THREE.BoxGeometry(1.5,1.5,1.5,1,1,1),h=new THREE.MeshPhongMaterial({emissive:16711680*Math.random(),opacity:1,transparent:!0}),r=new THREE.Mesh(o,h).clone();r.position.set(5+this.x-10*Math.random(),-5+this.y-8*Math.random(),this.z),stage.scene.add(r),setTimeout(function(){stage.scene.remove(r)},50),setTimeout(function(){r.geometry.dispose()},50);i=new THREE.BoxHelper(this.model,16711680);this.attackbbox=(new THREE.Box3).setFromObject(i),this.attackbbox.intersectsBox(this.otherPlayer.hitbbox)&&this.checkHit(US,"B"),hitBoxesOn&&(stage.scene.add(i),setTimeout(function(){i.geometry.dispose()},50),setTimeout(function(){stage.scene.remove(i)},50)),this.basicAttackFrames<=0&&(this.model.rotation.y=0,this.basicAttackFrames=25,this.canBAttack[US]=!0,this.canBasicAttack=!0,this.otherPlayer.hitByB[US]=!1)}if(!this.canBAttack[DS]){this.basicAttackFrames-=1;s=(this.specialAttackObj.attackFrames[DS]-this.basicAttackFrames)/this.specialAttackObj.attackFrames[DS];var c=1/this.specialAttackObj.attackFrames[DS];this.model.torso.rightArm.rotation.x=radians(-120*s),this.model.torso.rightArm.rightHand.sword.rotateOnWorldAxis(new THREE.Vector3(1,0,0),radians(90*c)),this.model.torso.rightArm.rightHand.sword.rotateOnWorldAxis(new THREE.Vector3(0,0,1),radians(-90*c)),heartHelper(this.hearts,!0,this.x,this.y,this.z),this.model.scale.set(2.5*s,2.5*s,1);i=new THREE.BoxHelper(this.model,16711680);this.attackbbox=(new THREE.Box3).setFromObject(i),this.model.scale.set(1,1,1),this.attackbbox.intersectsBox(this.otherPlayer.hitbbox)&&this.checkHit(DS,"B"),hitBoxesOn&&(stage.scene.add(i),setTimeout(function(){i.geometry.dispose()},50),setTimeout(function(){stage.scene.remove(i)},50)),this.basicAttackFrames<=0&&(heartHelper(this.hearts,!1,stage.maximumX+300,stage.maximumY+300,0),this.basicAttackFrames=25,this.model.torso.rightArm.rotation.y=0,this.model.torso.rightArm.rightHand.sword.rotation.set(0,0,.6),this.model.torso.rightArm.rightHand.sword.position.z=.7,this.canBAttack[DS]=!0,this.canBasicAttack=!0,this.otherPlayer.hitByB[DS]=!1)}},walkRight:function(){this.movingR=!0,this.facingR=!0,this.facingL=!1,this.xVel+=this.xAccel,this.xVel>this.maxXVel&&(this.xVel=this.maxXVel),this.isHit=!1},walkLeft:function(){this.movingL=!0,this.facingL=!0,this.facingR=!1,this.xVel-=this.xAccel,this.xVel<-this.maxXVel&&(this.xVel=-this.maxXVel),this.isHit=!1},jump:function(){this.sleeping||(this.jumpCt==this.maxJumpCt&&(this.canJump=!1),this.canJump&&(this.isHit||(this.jumpCt+=1,this.yVel=this.jumpSpeed,this.onGround=!1,this.isHit=!1)))},drop:function(){},recover:function(){this.isHit||(this.isRecover=!0,this.yVel=this.recoverVel,this.canRecover=!1,this.isHit=!1)},doAnyAttack:function(){var t=!1;if(this.canBasicAttack&&!this.isHit&&!this.isRecover){var s=0;this.heldKeys.up&&this.heldKeys.attack2&&this.canRecover&&!this.isRecover&&(this.recover(),this.canJump=!1),this.facingR&&this.heldKeys.right&&this.heldKeys.attack1&&!this.onGround&&this.canBasicAttack&&this.canAAttack[FA]&&(t=!0,s=this.basicAttackObj.attackFrames[FA],this.canAAttack[FA]=!1,this.canBasicAttack=!1),this.facingL&&this.heldKeys.left&&this.heldKeys.attack1&&!this.onGround&&this.canBasicAttack&&1==this.canAAttack[FA]&&(t=!0,s=this.basicAttackObj.attackFrames[FA],this.canAAttack[FA]=!1,this.canBasicAttack=!1),this.facingL&&this.heldKeys.right&&this.heldKeys.attack1&&!this.onGround&&this.canBasicAttack&&1==this.canAAttack[BA]&&(t=!0,s=this.basicAttackObj.attackFrames[BA],this.canAAttack[BA]=!1,this.canBasicAttack=!1),this.facingR&&this.heldKeys.left&&this.heldKeys.attack1&&!this.onGround&&this.canBasicAttack&&1==this.canAAttack[BA]&&(t=!0,s=this.basicAttackObj.attackFrames[BA],this.canAAttack[BA]=!1,this.canBasicAttack=!1),this.heldKeys.down&&this.heldKeys.attack1&&!this.onGround&&this.canBasicAttack&&1==this.canAAttack[DA]&&(t=!0,s=this.basicAttackObj.attackFrames[DA],this.canAAttack[DA]=!1,this.canBasicAttack=!1),this.heldKeys.up&&this.heldKeys.attack1&&!this.onGround&&this.canBasicAttack&&1==this.canAAttack[UA]&&(t=!0,s=this.basicAttackObj.attackFrames[UA],this.canAAttack[UA]=!1,this.canBasicAttack=!1),this.heldKeys.left||this.heldKeys.right||this.heldKeys.up||this.heldKeys.down||!this.heldKeys.attack1||this.onGround||!this.canBasicAttack||1==this.canAAttack[NA]&&(t=!0,s=this.basicAttackObj.attackFrames[NA],this.canAAttack[NA]=!1,this.canBasicAttack=!1),this.heldKeys.attack1&&this.onGround&&this.canBasicAttack&&1==this.canAAttack[A]&&(t=!0,s=this.basicAttackObj.attackFrames[A],this.canAAttack[A]=!1,this.canBasicAttack=!1),(this.heldKeys.right||this.heldKeys.left)&&this.heldKeys.attack2&&this.canBasicAttack&&1==this.canBAttack[SS]&&(t=!0,s=this.specialAttackObj.attackFrames[SS],this.canBAttack[SS]=!1,this.canBasicAttack=!1),this.heldKeys.down||this.heldKeys.up||this.heldKeys.left||this.heldKeys.right||!this.heldKeys.attack2||!this.canBasicAttack||1==this.canBAttack[S]&&(t=!0,s=this.specialAttackObj.attackFrames[S],this.canBAttack[S]=!1,this.canBasicAttack=!1),this.heldKeys.down&&this.heldKeys.attack2&&this.canBasicAttack&&1==this.canBAttack[DS]&&(t=!0,s=this.specialAttackObj.attackFrames[DS],this.canBAttack[DS]=!1,this.canBasicAttack=!1),this.heldKeys.up&&this.heldKeys.attack2&&this.canBasicAttack&&1==this.canBAttack[US]&&(t=!0,s=this.specialAttackObj.attackFrames[US],this.canBAttack[US]=!1,this.canBasicAttack=!1),this.basicAttackFrames=s,t&&(this.isPlayer1?player1Info.totalAttacksCast+=1:player2Info.totalAttacksCast+=1)}},checkHit:function(t,s){"A"==s?this.otherPlayer.hitByA[t]||(damageToDeal=this.basicAttackObj.damage[t],angleToApply=this.basicAttackObj.launchAngle[t],tKnockback=calculateKnockback(this.otherPlayer.percentage,this.basicAttackObj.damage[t],this.otherPlayer.weight,this.basicAttackObj.scaling,this.basicAttackObj.knockback),this.otherPlayer.isHit=!0,this.isPlayer1?player1Info.totalAttacksHit+=1:player2Info.totalAttacksHit+=1,this.otherPlayer.hitByA[t]=!0,this.doKnockBack(damageToDeal,angleToApply,tKnockback)):this.otherPlayer.hitByB[t]||(damageToDeal=this.specialAttackObj.damage[t],angleToApply=this.specialAttackObj.launchAngle[t],tKnockback=calculateKnockback(this.otherPlayer.percentage,this.specialAttackObj.damage[t],this.otherPlayer.weight,this.specialAttackObj.scaling,this.specialAttackObj.knockback),this.otherPlayer.isHit=!0,this.isPlayer1?player1Info.totalAttacksHit+=1:player2Info.totalAttacksHit+=1,this.otherPlayer.hitByB[t]=!0,this.doKnockBack(damageToDeal,angleToApply,tKnockback))},doKnockBack:function(t,s,i){var e,a,o=new THREE.Vector2;o.x=this.otherPlayer.x-this.x,o.y=this.otherPlayer.y-this.y,o=o.normalize(),e=Math.cos(radians(s))*o.x-Math.sin(radians(s))*o.y,a=Math.sin(radians(s))*o.x+Math.cos(radians(s))*o.y,o.x=e,o.y=Math.abs(a),o=o.normalize(),this.isPlayer1?player1Info.damageDealt+=t:player2Info.damageDealt+=t,this.otherPlayer.percentage+=t,this.otherPlayer.xVel=.5*i*o.x,this.otherPlayer.yVel=.5*i*o.y,this.otherPlayer.hitFrames=2*t,this.otherPlayer.xVel>0?this.otherPlayer.model.rotation.z=-1.57:this.otherPlayer.model.rotation.z=1.57}},pingu1={name:"Pingu",model:createPinguMesh(0,0,0),secondary:createPinguMesh(0,0,0),hitBox:createPinguBounding(0,0,0),canAAttack:[!0,!0,!0,!0,!0,!0],canBAttack:[!0,!0,!0,!0],hitByA:[!1,!1,!1,!1,!1],hitByB:[!1,!1,!1,!1],init:function(){for(var t=Object.keys(charProto),s=0;s<t.length;s++)this[t[s]]=charProto[t[s]];this.name="Pingu",stage.scene.add(this.secondary),this.hearts=createHearts(stage,stage.maximumX+300,stage.maximumY+300,0),this.secondary.position.set(stage.maximumX+300,stage.maximumY+300,0),this.recoverVel=3.5,this.jumpSpeed=2,this.heldKeys={up:!1,down:!1,left:!1,right:!1,attack1:!1,attack2:!1},this.basicAttackObj=pinguBasic,this.specialAttackObj=pinguSpecial},setSpawn:function(){this.isPlayer1?(this.x=stage.player1SpawnX,this.y=stage.player1SpawnY,this.z=stage.player1SpawnZ):(this.x=stage.player2SpawnX,this.y=stage.player2SpawnY,this.z=stage.player2SpawnZ)},update:function(){if(this.onGround||(this.isPlayer1?player1Info.inAirDuration+=1/60:player2Info.inAirDuration+=1/60),this.hitbbox=(new THREE.Box3).setFromObject(this.hitBox),isDay||(this.isPlayer1?(stage.player1SpotTarget.position.set(this.x,this.y+10,-10),stage.player1Spot.target=stage.player1SpotTarget):(stage.player2SpotTarget.position.set(this.x,this.y+10,-10),stage.player2Spot.target=stage.player2SpotTarget)),null!=this.boxBelow?this.minDown=this.boxBelow.position.y+this.boxBelow.userData.height/2+this.height/2:this.minDown=-1e3,null!=this.boxLeft?this.minLeft=this.boxLeft.position.x+this.boxLeft.userData.width/2+this.width/2:this.minLeft=-1e3,null!=this.boxRight?this.minRight=this.boxRight.position.x-this.boxRight.userData.width/2-this.width/2:this.minRight=1e3,null!=this.boxAbove?this.minUp=this.boxAbove.position.y-this.boxAbove.userData.height/2-this.height/2:this.minUp=1e5,this.isHit&&(this.hitFrames-=1,this.sleeping=!1),this.hitFrames<0&&(this.isHit=!1),this.yVel-.075<-1.6&&(this.yVel=-1.6),this.yVel-=.075,this.x+=this.xVel,this.y+=this.yVel,this.xVel>8||this.yVel>8){var t=this.model.clone();stage.scene.add(t),setTimeout(function(){stage.scene.remove(t)},50)}this.heldKeys.up&&this.heldKeys.attack2&&this.canRecover&&!this.isRecover&&(this.sleeping||(this.recover(),this.canJump=!1)),!this.heldKeys.right||this.heldKeys.left||this.isHit||this.walkRight(),!this.heldKeys.left||this.heldKeys.right||this.isHit||this.walkLeft(),this.movingR||this.movingL||!this.onGround||this.isHit||(this.xVel=.7*this.xVel),this.movingR||this.movingL||this.onGround||this.isHit||(this.xVel=.98*this.xVel),Math.abs(this.xVel)<5e-4&&(this.xVel=0),this.y<this.minDown&&(this.y=this.minDown,this.canJump=!0,this.jumpCt=0,this.onGround=!0,this.canRecover=!0,this.isRecover=!1),this.y>this.minUp&&(this.y=this.minUp,this.yVel=0),this.x<this.minLeft&&(this.x=this.minLeft),this.x>this.minRight&&(this.x=this.minRight),0==this.stock?(this.model.position.set(1e3,1e3,0),this.hitBox.position.set(1e3,1e3,0)):(this.model.position.set(this.x,this.y,this.z),this.hitBox.position.set(this.x,this.y+2,this.z)),this.y>this.minDown&&(this.onGround=!1)},animate:function(){if(this.isRecoiling&&(this.recoilFrames-=1,this.recoilFrames<=0&&(this.recoilFrames=this.recoilFrameDefault,this.isRecoiling=!1)),this.facingR&&this.canBAttack[US]&&(this.model.rotation.y=.5),this.facingL&&this.canBAttack[US]&&(this.model.rotation.y=-.5),!this.movingR&&!this.movingL||0==this.xVel||this.isHit?(this.model.torso.rightLeg.position.y=-3,this.model.torso.leftLeg.position.y=-3,this.model.torso.rightLeg.rotation.x=0,this.model.torso.leftLeg.rotation.x=0,this.model.torso.rightArm.rotation.x=0,this.model.torso.leftArm.rotation.x=-0,this.canBasicAttack&&!this.isHit&&(this.model.rotation.z=0)):(this.walkStyle1&&(this.model.torso.rightLeg.rotation.x=.4*Math.sin(.7*stage.timer),this.model.torso.leftLeg.rotation.x=-.4*Math.sin(.7*stage.timer)),this.model.torso.rightArm.rotation.x=.3*Math.sin(.5*stage.timer),this.model.torso.leftArm.rotation.x=-.3*Math.sin(.5*stage.timer),this.canBasicAttack&&(this.model.rotation.z=0)),stage.timer%500==0?(this.model.head.rightEye.scale.set(1,.2,1),this.model.head.leftEye.scale.set(1,.2,1)):(this.model.head.rightEye.scale.set(1,1,1),this.model.head.leftEye.scale.set(1,1,1)),!this.canAAttack[A]){var t=1-(this.recoilFrameDefault-this.recoilFrames)/this.recoilFrameDefault,s=(this.basicAttackObj.attackFrames[A]-this.basicAttackFrames)/this.basicAttackObj.attackFrames[A];if(this.isRecoiling?this.facingL?(this.model.torso.rightArm.scale.set(1+s*t*.6,1+s*t*.6,1+s*t*.6),this.model.torso.rightArm.rightHand.sword.scale.set(1,1+s*t*1,1),this.model.torso.rightArm.rotation.z=t*this.model.torso.rightArm.rotation.z):(this.model.torso.leftArm.scale.set(1+s*t*.6,1+s*t*.6,1+s*t*.6),this.model.torso.leftArm.rotation.z=t*this.model.torso.leftArm.rotation.z):(this.basicAttackFrames-=1,this.facingL?(s<.25&&(this.model.torso.rightArm.scale.set(1+.6*s*4,1+.6*s*4,1+.6*s*4),this.model.torso.rightArm.rightHand.sword.scale.set(1,1+1*s*4,1)),this.model.torso.rightArm.rotation.z+=.1):s<.25?this.model.torso.leftArm.scale.set(1.6,2,1.6):this.model.torso.leftArm.rotation.z=s*radians(180)),this.facingL){var i=new THREE.BoxHelper(this.model.torso.rightArm.rightHand.sword,16711680);this.attackbbox=(new THREE.Box3).setFromObject(i),this.attackbbox.intersectsBox(this.otherPlayer.hitbbox)&&this.checkHit(A,"A"),hitBoxesOn&&(stage.scene.add(i),setTimeout(function(){i.geometry.dispose()},50),setTimeout(function(){stage.scene.remove(i)},50))}else{i=new THREE.BoxHelper(this.model.torso.leftArm,16711680);this.attackbbox=(new THREE.Box3).setFromObject(i),this.attackbbox.intersectsBox(this.otherPlayer.hitbbox)&&this.checkHit(A,"A"),hitBoxesOn&&(stage.scene.add(i),setTimeout(function(){i.geometry.dispose()},50),setTimeout(function(){stage.scene.remove(i)},50))}this.basicAttackFrames<=0&&(this.model.torso.rightArm.scale.set(1,1,1),this.model.torso.leftArm.scale.set(1,1,1),this.model.torso.rightArm.rightHand.sword.scale.set(1,1,1),this.model.torso.rightArm.rotation.z=0,this.model.torso.leftArm.rotation.z=0,this.basicAttackFrames=25,this.canAAttack[A]=!0,this.canBasicAttack=!0,this.otherPlayer.hitByA[A]=!1)}if(!this.canAAttack[FA]){this.basicAttackFrames-=1;s=(this.basicAttackObj.attackFrames[FA]-this.basicAttackFrames)/this.basicAttackObj.attackFrames[FA];this.facingL?(s<.25?(this.model.rotation.z=4*s*1.57,this.model.torso.rightArm.scale.set(1.6,1.6,1.6),this.model.torso.rightArm.rightHand.sword.scale.set(1,2.2,1),this.model.torso.rightArm.rotation.z-=.1):this.model.rotation.x=3*s*3.14,this.x-1.8>=this.minLeft&&(this.x-=1.8)):(s<.25?(this.model.rotation.z=-4*s*1.57,this.model.torso.rightArm.scale.set(1.6,1.6,1.6),this.model.torso.rightArm.rightHand.sword.scale.set(1,2.2,1),this.model.torso.rightArm.rotation.z-=.1):this.model.rotation.x=3*s*3.14,this.x+1.8<=this.minRight&&(this.x+=1.8));i=new THREE.BoxHelper(this.model.torso.rightArm.rightHand.sword,16711680);this.attackbbox=(new THREE.Box3).setFromObject(i),this.attackbbox.intersectsBox(this.otherPlayer.hitbbox)&&this.checkHit(FA,"A"),hitBoxesOn&&(stage.scene.add(i),setTimeout(function(){i.geometry.dispose()},50),setTimeout(function(){stage.scene.remove(i)},50)),this.basicAttackFrames<=0&&(this.model.rotation.z=0,this.model.rotation.x=0,this.model.torso.rightArm.rotation.z=0,this.model.torso.rightArm.scale.set(1,1,1),this.model.torso.leftArm.scale.set(1,1,1),this.model.torso.rightArm.rightHand.sword.scale.set(1,1,1),this.basicAttackFrames=25,this.canAAttack[FA]=!0,this.canBasicAttack=!0,this.otherPlayer.hitByA[FA]=!1)}if(!this.canAAttack[BA]){t=1-(this.recoilFrameDefault-this.recoilFrames)/this.recoilFrameDefault,s=(this.basicAttackObj.attackFrames[BA]-this.basicAttackFrames)/this.basicAttackObj.attackFrames[BA];if(this.basicAttackFrames-=1,this.facingL?(s<.25&&(this.model.torso.rightArm.scale.set(1+.6*s*4,1+.6*s*4,1+.6*s*4),this.model.torso.rightArm.rightHand.sword.scale.set(1,1+1*s*4,1)),this.model.torso.rightArm.rotation.z+=.1):s<.25?this.model.torso.leftArm.scale.set(1.6,2,1.6):this.model.torso.leftArm.rotation.z=s*radians(180),this.facingL){i=new THREE.BoxHelper(this.model.torso.rightArm.rightHand.sword,16711680);this.attackbbox=(new THREE.Box3).setFromObject(i),this.attackbbox.intersectsBox(this.otherPlayer.hitbbox)&&this.checkHit(BA,"A"),hitBoxesOn&&(stage.scene.add(i),setTimeout(function(){i.geometry.dispose()},50),setTimeout(function(){stage.scene.remove(i)},50))}else{i=new THREE.BoxHelper(this.model.torso.leftArm,16711680);this.attackbbox=(new THREE.Box3).setFromObject(i),this.attackbbox.intersectsBox(this.otherPlayer.hitbbox)&&this.checkHit(BA,"A"),hitBoxesOn&&(stage.scene.add(i),setTimeout(function(){i.geometry.dispose()},50),setTimeout(function(){stage.scene.remove(i)},50))}this.basicAttackFrames<=0&&(this.model.torso.rightArm.scale.set(1,1,1),this.model.torso.leftArm.scale.set(1,1,1),this.model.torso.rightArm.rightHand.sword.scale.set(1,1,1),this.model.torso.rightArm.rotation.z=0,this.model.torso.leftArm.rotation.z=0,this.basicAttackFrames=25,this.canAAttack[BA]=!0,this.canBasicAttack=!0,this.otherPlayer.hitByA[BA]=!1)}if(!this.canAAttack[DA]){this.basicAttackFrames-=1;s=(this.basicAttackObj.attackFrames[DA]-this.basicAttackFrames)/this.basicAttackObj.attackFrames[DA];this.model.torso.rightLeg.scale.set(1.1,1,3),this.model.torso.leftLeg.scale.set(1.1,1,3),this.model.torso.rightLeg.rotation.x=-s*Math.sin(.5*this.basicAttackFrames),this.model.torso.leftLeg.rotation.x=s*Math.sin(.5*this.basicAttackFrames);var e=new THREE.BoxHelper(this.model.torso.rightLeg,16711680);this.attackbbox=(new THREE.Box3).setFromObject(e),this.attackbbox.intersectsBox(this.otherPlayer.hitbbox)&&this.checkHit(DA,"A");var a=new THREE.BoxHelper(this.model.torso.leftLeg,16711680);this.attackbbox=(new THREE.Box3).setFromObject(a),this.attackbbox.intersectsBox(this.otherPlayer.hitbbox)&&this.checkHit(DA,"A"),hitBoxesOn&&(stage.scene.add(e),setTimeout(function(){e.geometry.dispose()},50),setTimeout(function(){stage.scene.remove(e)},50),stage.scene.add(a),setTimeout(function(){a.geometry.dispose()},50),setTimeout(function(){stage.scene.remove(a)},50)),this.basicAttackFrames<=0&&(this.model.torso.rightLeg.scale.set(1,1,1),this.model.torso.leftLeg.scale.set(1,1,1),this.basicAttackFrames=25,this.canAAttack[DA]=!0,this.canBasicAttack=!0,this.otherPlayer.hitByA[DA]=!1)}if(!this.canAAttack[UA]){this.basicAttackFrames-=1;s=(this.basicAttackObj.attackFrames[UA]-this.basicAttackFrames)/this.basicAttackObj.attackFrames[UA];this.model.torso.rightArm.scale.set(1+.6*s,1+.6*s,1+.6*s),this.model.torso.rightArm.rightHand.sword.scale.set(1,2,1),s<.25?(this.model.torso.rightArm.rotation.z=-8*s*1.57,this.model.torso.rightArm.rightHand.sword.rotation.z=7.8*s*1.57,this.model.torso.rightArm.rightHand.sword.position.x+=.01,this.model.torso.rightArm.rightHand.sword.position.y-=.05,this.model.torso.rightArm.rightHand.sword.position.z-=.2):this.model.rotation.y=s*radians(720);i=new THREE.BoxHelper(this.model.torso.rightArm.rightHand.sword,16711680);this.attackbbox=(new THREE.Box3).setFromObject(i),this.attackbbox.intersectsBox(this.otherPlayer.hitbbox)&&this.checkHit(UA,"A"),hitBoxesOn&&(stage.scene.add(i),setTimeout(function(){i.geometry.dispose()},50),setTimeout(function(){stage.scene.remove(i)},50)),this.basicAttackFrames<=0&&(this.model.torso.rightArm.scale.set(1,1,1),this.model.torso.leftArm.scale.set(1,1,1),this.model.torso.rightArm.rightHand.sword.scale.set(1,1,1),this.model.torso.rightArm.rightHand.sword.position.set(-.4,1,.7),this.model.torso.rightArm.rightHand.sword.rotation.set(0,0,.6),this.model.torso.rightArm.rotation.z=0,this.model.rotation.y=0,this.basicAttackFrames=25,this.canAAttack[UA]=!0,this.canBasicAttack=!0,this.otherPlayer.hitByA[UA]=!1)}if(!this.canAAttack[NA]){this.basicAttackFrames-=1;s=(this.basicAttackObj.attackFrames[NA]-this.basicAttackFrames)/this.basicAttackObj.attackFrames[NA];this.model.rotation.z=2*s*Math.PI,this.model.torso.rightArm.scale.set(1+.6*s,1+.6*s,1+.6*s),this.model.torso.rightArm.rightHand.sword.scale.set(1,2,1),this.model.torso.rightArm.rotation.z+=.1;i=new THREE.BoxHelper(this.model.torso.rightArm.rightHand.sword,16711680);this.attackbbox=(new THREE.Box3).setFromObject(i),this.attackbbox.intersectsBox(this.otherPlayer.hitbbox)&&this.checkHit(NA,"A"),hitBoxesOn&&(stage.scene.add(i),setTimeout(function(){i.geometry.dispose()},50),setTimeout(function(){stage.scene.remove(i)},50)),this.basicAttackFrames<=0&&(this.model.rotation.z=0,this.model.torso.rightArm.scale.set(1,1,1),this.model.torso.rightArm.rightHand.sword.scale.set(1,1,1),this.model.torso.rightArm.rotation.z=.1,this.basicAttackFrames=25,this.canAAttack[NA]=!0,this.canBasicAttack=!0,this.otherPlayer.hitByA[NA]=!1)}if(!this.canBAttack[S]){this.basicAttackFrames-=1.5,dabbing(ATTACK,this.model);i=new THREE.BoxHelper(this.model,16711680);this.attackbbox=(new THREE.Box3).setFromObject(i),this.attackbbox.intersectsBox(this.otherPlayer.hitbbox)&&this.checkHit(S,"B"),hitBoxesOn&&(stage.scene.add(i),setTimeout(function(){i.geometry.dispose()},50),setTimeout(function(){stage.scene.remove(i)},50)),this.basicAttackFrames<=0&&(dabbing(RESET,this.model),this.basicAttackFrames=25,this.canBAttack[S]=!0,this.canBasicAttack=!0,this.otherPlayer.hitByB[S]=!1)}if(!this.canBAttack[SS]){this.basicAttackFrames-=1,dabbing(ATTACK,this.model),this.basicAttackFrames!=this.specialAttackObj.attackFrames[SS]-1||this.isRecover?(this.specialAttackObj.castedRight||(this.secondary.position.x-=2.5),this.specialAttackObj.castedRight&&(this.secondary.position.x+=2.5)):(this.facingL&&(this.specialAttackObj.castedRight=!1,this.secondary.position.set(this.x,this.y,this.z)),this.facingR&&(this.specialAttackObj.castedRight=!0,this.secondary.position.set(this.x,this.y,this.z))),dabbing(ATTACK,this.secondary);i=new THREE.BoxHelper(this.secondary,16711680);this.attackbbox=(new THREE.Box3).setFromObject(i),this.attackbbox.intersectsBox(this.otherPlayer.hitbbox)&&this.checkHit(SS,"B"),hitBoxesOn&&(stage.scene.add(i),setTimeout(function(){i.geometry.dispose()},50),setTimeout(function(){stage.scene.remove(i)},50)),this.basicAttackFrames<=0&&(dabbing(RESET,this.model),dabbing(RESET,this.secondary),this.basicAttackFrames=25,this.canBAttack[SS]=!0,this.canBasicAttack=!0,this.otherPlayer.hitByB[SS]=!1,this.secondary.position.set(stage.maximumX+300,stage.maximumY+300,0))}if(!this.canBAttack[US]){this.basicAttackFrames-=2.5,this.model.rotation.y+=.78;var o=new THREE.BoxGeometry(1.5,1.5,1.5,1,1,1),h=new THREE.MeshPhongMaterial({emissive:16711680*Math.random(),opacity:1,transparent:!0}),r=new THREE.Mesh(o,h).clone();r.position.set(5+this.x-10*Math.random(),-5+this.y-8*Math.random(),this.z),stage.scene.add(r),setTimeout(function(){stage.scene.remove(r)},50),setTimeout(function(){r.geometry.dispose()},50);i=new THREE.BoxHelper(this.model,16711680);this.attackbbox=(new THREE.Box3).setFromObject(i),this.attackbbox.intersectsBox(this.otherPlayer.hitbbox)&&this.checkHit(US,"B"),hitBoxesOn&&(stage.scene.add(i),setTimeout(function(){i.geometry.dispose()},50),setTimeout(function(){stage.scene.remove(i)},50)),this.basicAttackFrames<=0&&(this.model.rotation.y=0,this.basicAttackFrames=25,this.canBAttack[US]=!0,this.canBasicAttack=!0,this.otherPlayer.hitByB[US]=!1)}if(!this.canBAttack[DS]){this.basicAttackFrames-=1;s=(this.specialAttackObj.attackFrames[DS]-this.basicAttackFrames)/this.specialAttackObj.attackFrames[DS];var c=1/this.specialAttackObj.attackFrames[DS];this.model.torso.rightArm.rotation.x=radians(-120*s),this.model.torso.rightArm.rightHand.sword.rotateOnWorldAxis(new THREE.Vector3(1,0,0),radians(90*c)),this.model.torso.rightArm.rightHand.sword.rotateOnWorldAxis(new THREE.Vector3(0,0,1),radians(-90*c)),heartHelper(this.hearts,!0,this.x,this.y,this.z),this.model.scale.set(2.5*s,2.5*s,1);i=new THREE.BoxHelper(this.model,16711680);this.attackbbox=(new THREE.Box3).setFromObject(i),this.model.scale.set(1,1,1),this.attackbbox.intersectsBox(this.otherPlayer.hitbbox)&&this.checkHit(DS,"B"),hitBoxesOn&&(stage.scene.add(i),setTimeout(function(){i.geometry.dispose()},50),setTimeout(function(){stage.scene.remove(i)},50)),this.basicAttackFrames<=0&&(heartHelper(this.hearts,!1,stage.maximumX+300,stage.maximumY+300,0),this.basicAttackFrames=25,this.model.torso.rightArm.rotation.y=0,this.model.torso.rightArm.rightHand.sword.rotation.set(0,0,.6),this.model.torso.rightArm.rightHand.sword.position.z=.7,this.canBAttack[DS]=!0,this.canBasicAttack=!0,this.otherPlayer.hitByB[DS]=!1)}},walkRight:function(){this.movingR=!0,this.facingR=!0,this.facingL=!1,this.xVel+=this.xAccel,this.xVel>this.maxXVel&&(this.xVel=this.maxXVel),this.isHit=!1},walkLeft:function(){this.movingL=!0,this.facingL=!0,this.facingR=!1,this.xVel-=this.xAccel,this.xVel<-this.maxXVel&&(this.xVel=-this.maxXVel),this.isHit=!1},jump:function(){this.sleeping||(this.jumpCt==this.maxJumpCt&&(this.canJump=!1),this.canJump&&(this.isHit||(this.jumpCt+=1,this.yVel=this.jumpSpeed,this.onGround=!1,this.isHit=!1)))},drop:function(){},recover:function(){this.isHit||(this.isRecover=!0,this.yVel=this.recoverVel,this.canRecover=!1,this.isHit=!1)},doAnyAttack:function(){var t=!1;if(this.canBasicAttack&&!this.isHit&&!this.isRecover){var s=0;this.heldKeys.up&&this.heldKeys.attack2&&this.canRecover&&!this.isRecover&&(this.recover(),this.canJump=!1),this.facingR&&this.heldKeys.right&&this.heldKeys.attack1&&!this.onGround&&this.canBasicAttack&&this.canAAttack[FA]&&(t=!0,s=this.basicAttackObj.attackFrames[FA],this.canAAttack[FA]=!1,this.canBasicAttack=!1),this.facingL&&this.heldKeys.left&&this.heldKeys.attack1&&!this.onGround&&this.canBasicAttack&&1==this.canAAttack[FA]&&(t=!0,s=this.basicAttackObj.attackFrames[FA],this.canAAttack[FA]=!1,this.canBasicAttack=!1),this.facingL&&this.heldKeys.right&&this.heldKeys.attack1&&!this.onGround&&this.canBasicAttack&&1==this.canAAttack[BA]&&(t=!0,s=this.basicAttackObj.attackFrames[BA],this.canAAttack[BA]=!1,this.canBasicAttack=!1),this.facingR&&this.heldKeys.left&&this.heldKeys.attack1&&!this.onGround&&this.canBasicAttack&&1==this.canAAttack[BA]&&(t=!0,s=this.basicAttackObj.attackFrames[BA],this.canAAttack[BA]=!1,this.canBasicAttack=!1),this.heldKeys.down&&this.heldKeys.attack1&&!this.onGround&&this.canBasicAttack&&1==this.canAAttack[DA]&&(t=!0,s=this.basicAttackObj.attackFrames[DA],this.canAAttack[DA]=!1,this.canBasicAttack=!1),this.heldKeys.up&&this.heldKeys.attack1&&!this.onGround&&this.canBasicAttack&&1==this.canAAttack[UA]&&(t=!0,s=this.basicAttackObj.attackFrames[UA],this.canAAttack[UA]=!1,this.canBasicAttack=!1),this.heldKeys.left||this.heldKeys.right||this.heldKeys.up||this.heldKeys.down||!this.heldKeys.attack1||this.onGround||!this.canBasicAttack||1==this.canAAttack[NA]&&(t=!0,s=this.basicAttackObj.attackFrames[NA],this.canAAttack[NA]=!1,this.canBasicAttack=!1),this.heldKeys.attack1&&this.onGround&&this.canBasicAttack&&1==this.canAAttack[A]&&(t=!0,s=this.basicAttackObj.attackFrames[A],this.canAAttack[A]=!1,this.canBasicAttack=!1),(this.heldKeys.right||this.heldKeys.left)&&this.heldKeys.attack2&&this.canBasicAttack&&1==this.canBAttack[SS]&&(t=!0,s=this.specialAttackObj.attackFrames[SS],this.canBAttack[SS]=!1,this.canBasicAttack=!1),this.heldKeys.down||this.heldKeys.up||this.heldKeys.left||this.heldKeys.right||!this.heldKeys.attack2||!this.canBasicAttack||1==this.canBAttack[S]&&(t=!0,s=this.specialAttackObj.attackFrames[S],this.canBAttack[S]=!1,this.canBasicAttack=!1),this.heldKeys.down&&this.heldKeys.attack2&&this.canBasicAttack&&1==this.canBAttack[DS]&&(t=!0,s=this.specialAttackObj.attackFrames[DS],this.canBAttack[DS]=!1,this.canBasicAttack=!1),this.heldKeys.up&&this.heldKeys.attack2&&this.canBasicAttack&&1==this.canBAttack[US]&&(t=!0,s=this.specialAttackObj.attackFrames[US],this.canBAttack[US]=!1,this.canBasicAttack=!1),this.basicAttackFrames=s,t&&(this.isPlayer1?player1Info.totalAttacksCast+=1:player2Info.totalAttacksCast+=1)}},checkHit:function(t,s){"A"==s?this.otherPlayer.hitByA[t]||(damageToDeal=this.basicAttackObj.damage[t],angleToApply=this.basicAttackObj.launchAngle[t],tKnockback=calculateKnockback(this.otherPlayer.percentage,this.basicAttackObj.damage[t],this.otherPlayer.weight,this.basicAttackObj.scaling,this.basicAttackObj.knockback),this.otherPlayer.isHit=!0,this.isPlayer1?player1Info.totalAttacksHit+=1:player2Info.totalAttacksHit+=1,this.otherPlayer.hitByA[t]=!0,this.doKnockBack(damageToDeal,angleToApply,tKnockback)):this.otherPlayer.hitByB[t]||(damageToDeal=this.specialAttackObj.damage[t],angleToApply=this.specialAttackObj.launchAngle[t],tKnockback=calculateKnockback(this.otherPlayer.percentage,this.specialAttackObj.damage[t],this.otherPlayer.weight,this.specialAttackObj.scaling,this.specialAttackObj.knockback),this.otherPlayer.isHit=!0,this.isPlayer1?player1Info.totalAttacksHit+=1:player2Info.totalAttacksHit+=1,this.otherPlayer.hitByB[t]=!0,this.doKnockBack(damageToDeal,angleToApply,tKnockback))},doKnockBack:function(t,s,i){var e,a,o=new THREE.Vector2;o.x=this.otherPlayer.x-this.x,o.y=this.otherPlayer.y-this.y,o=o.normalize(),e=Math.cos(radians(s))*o.x-Math.sin(radians(s))*o.y,a=Math.sin(radians(s))*o.x+Math.cos(radians(s))*o.y,o.x=e,o.y=Math.abs(a),o=o.normalize(),this.isPlayer1?player1Info.damageDealt+=t:player2Info.damageDealt+=t,this.otherPlayer.percentage+=t,this.otherPlayer.xVel=.5*i*o.x,this.otherPlayer.yVel=.5*i*o.y,this.otherPlayer.hitFrames=2*t,this.otherPlayer.xVel>0?this.otherPlayer.model.rotation.z=-1.57:this.otherPlayer.model.rotation.z=1.57}};function dabbing(t,s){t?(s.torso.rightArm.rotation.z=-1.96,s.torso.rightArm.rightHand.sword.rotation.z=2.75,s.torso.leftArm.rotation.z=-1.96,s.torso.leftArm.position.z=2.5,s.torso.leftArm.position.y=3,s.torso.leftArm.position.x=2,s.rotation.z=-.39):(s.torso.rightArm.rotation.z=0,s.torso.rightArm.rightHand.sword.rotation.z=.6,s.torso.leftArm.rotation.z=0,s.torso.leftArm.position.z=0,s.torso.leftArm.position.y=.5,s.torso.leftArm.position.x=4)}function createHearts(t,s,i,e){for(var a=[],o=0;o<22;o++){var h=particles.particlePalette.heartPiece.clone();a.push(h),t.scene.add(h)}return a}function heartHelper(t,s,i,e,a){var o=2.5;a+=8,e-=3.4;var h=pingu.basicAttackFrames,r=pingu.specialAttackObj.attackFrames[DS],c=(r-h)/r;if(s)t[0].position.set(i,e+10,a),t[1].position.set(i+o*c,e+10+o*c,a),t[2].position.set(i-o*c,e+10+o*c,a),t[3].position.set(i+o*c*2,e+10+5*c,a),t[4].position.set(i-o*c*2,e+10+5*c,a),t[5].position.set(i+o*c*3,e+10+5*c,a),t[6].position.set(i-o*c*3,e+10+5*c,a),t[7].position.set(i+o*c*4,e+10+o*c,a),t[8].position.set(i-o*c*4,e+10+o*c,a),t[9].position.set(i+o*c*5,e+10,a),t[10].position.set(i-o*c*5,e+10,a),t[11].position.set(i+o*c*4.5,e+10-o*c,a),t[12].position.set(i-o*c*4.5,e+10-o*c,a),t[13].position.set(i+o*c*4,e+10-5*c,a),t[14].position.set(i-o*c*4,e+10-5*c,a),t[15].position.set(i+o*c*3,e+10-7.5*c,a),t[16].position.set(i-o*c*3,e+10-7.5*c,a),t[17].position.set(i+o*c*2,e+10-10*c,a),t[18].position.set(i-o*c*2,e+10-10*c,a),t[19].position.set(i+o*c,e+10-11.25*c,a),t[20].position.set(i-o*c,e+10-11.25*c,a),t[21].position.set(i,e+10-5*o*c,a);else for(var n=0;n<t.length;n++)t[n].position.set(i,e,a)}
